<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"    
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
      
    <h:head>
        <title>Diagnósticos</title>
    </h:head>

    <h:body>

        <ui:composition template="../template/mainLayout.xhtml">

            <ui:define name="content">

                <div class="mainPanel">

                    <h:form id="mainForm">

                        <div id="busqueda" style="padding-bottom: 0px;">
                            
                            <p:outputLabel value="Diagnósticos" style="color: #FFFFFF;font-size: 18px !important;font-weight: bold;margin-right: 20px;"/>
                            <p:spacer width="10"/>
                                <p:inputText id="textSearch" style="width: 50%!important;border-radius:10px!important;" 
                                             value="#{diagnosticosMB.cadenaBusqueda}" class="textSearch" placeholder="Buscar..." />
                                <i class="iconSearch">
                                    <img src="../../resources/img/Medicamento/search-lupa.png" title="Presiona para buscar" alt="15"/>
                                </i>
                                <p:commandButton title="Buscar" value="Buscar" icon="ui-icon-search" actionListener="#{diagnosticosMB.buscarDiagnostico}"
                                                 update=":mainForm" ajax="false" validateClient="true" onclick="PF('statusProcess').show();"
                                                 oncomplete="PF('statusProcess').hide();" style=" margin-left: 15px; margin-bottom: 8px;" />
                                
                        </div>
                            <p:messages id="messages" class="validaMsg" globalOnly="true" closable="true" >
                                <p:autoUpdate />
                            </p:messages>                       

                            <p:commandButton class="btnNew" value="Agregar" disabled="#{diagnosticosMB.btnNew}" icon="fa fa-plus" rendered="#{diagnosticosMB.permiso.puedeCrear}"
                                             actionListener="#{diagnosticosMB.crearDiagnostico}" onclick="PF('statusProcess').show();" styleClass="btnMusAzul"
                                             oncomplete="PF('statusProcess').hide(); PF('modalDiagnostico').show();"
                                             ajax="true" update=":formModal"  style=" margin: 5px 0; " resetValues="true"  /> &nbsp;&nbsp;

                            <br/>

                            <p:outputLabel value="No tiene permiso de visualización de esta transacción." 
                                   style="font-size: 18px !important; font-weight: bold; color: red;"
                                   rendered="#{!diagnosticosMB.permiso.puedeVer}" />
                            
                            <p:dataTable  id="tblDiagnosticos"  styleClass="cabecera" 
                                      var="item" reflow="true"   
                                      lazy="true"
                                      value="#{diagnosticosMB.diagnosticosLazy}"                                          
                                      style="margin-bottom:5px;"                                      
                                      scrollRows="10" scrollable="true" liveScroll="true" scrollHeight="350" 
                                     paginatorPosition="bottom"
                                     rows="10"
                                     paginator="true"
                                     paginatorTemplate=" {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     rendered="#{diagnosticosMB.permiso.puedeVer}"
                                      >
                            <p:column headerText="Clave" style="width: 30px;" sortBy="#{item.clave}" >
                                <h:outputText value="#{item.clave}" class="altoColumn" />
                            </p:column>  
                            <p:column headerText="Nombre" style="width: 250px;" sortBy="#{item.nombre}" >
                                <h:outputText value="#{item.nombre}" class="altoColumn" />
                            </p:column>  
                            <p:column headerText="Descripción" style="width: 100px;" sortBy="#{item.descripcion}" >
                                <h:outputText value="#{item.descripcion}" class="altoColumn" />
                            </p:column>
                            <p:column headerText="Estatus" style="width: 20px;" sortBy="#{item.activo}" >
                                <h:outputText value="#{item.activo ? 'Si' : 'No' }" class="altoColumn" />
                            </p:column>
                            <p:column headerText="Acciones" style="width: 70px;" >
                                <p:commandLink title="Ver"  actionListener="#{diagnosticosMB.obtenerDiagnostico(item.idDiagnostico, item.activo)}" rendered="#{diagnosticosMB.permiso.puedeVer}"
                                               onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide(); PF('modalDiagnostico').show();" update=":formModal" >
                                    <i class="fa fa-eye  iconMusAzul" />
                                </p:commandLink> &nbsp;
                                <p:commandLink title="#{item.activo ? 'Desactivar' : 'Activar'}" actionListener="#{diagnosticosMB.cambiarEstatusDiagnostico(item.idDiagnostico,item.activo)}" 
                                               rendered="#{diagnosticosMB.permiso.puedeEditar}" onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();" 
                                               update=":mainForm:tblDiagnosticos " >
                                    <i class="#{item.activo ? 'fa fa-toggle-on' : 'fa fa-toggle-off'}  iconMusAzul" />

                                </p:commandLink> &nbsp;
                            </p:column>                 
                        </p:dataTable>
                    </h:form>
                    
                    <p:dialog header="Información del Diagnóstico"
                              widgetVar="modalDiagnostico"
                              closeOnEscape="true"
                              closable="true"   styleClass="autoWidthDialog"                     
                              modal="true" responsive="true" width="54%"  > 
                        <h:form id="formModal" style="padding: 0px;">                                 
                            <p:messages id="messages2" showDetail="false" globalOnly="false" closable="true" >
                                <p:autoUpdate />
                            </p:messages>
                            
                            <p:panelGrid columns="4"  >
                                <p:outputLabel value="Clave*"/>
                                <p:inputText value="#{diagnosticosMB.diagnosticoSelect.clave}" size="10" tabindex="1"  />
                                
                                <p:outputLabel value="Nombre*"/>
                                <p:inputTextarea value="#{diagnosticosMB.diagnosticoSelect.nombre}" cols="50" rows="3" tabindex="2" />
                                
                                <p:outputLabel value="Activo"/>
                                <p:selectBooleanButton id="txtActivo" onLabel="Si" offLabel="No"                                 
                                    onIcon="ui-icon-check" offIcon="ui-icon-close" 
                                    value="#{diagnosticosMB.diagnosticoSelect.activo}" 
                                    tabindex="3" />
                                
                                <p:outputLabel value="Descripción"/>
                                <p:inputText value="#{diagnosticosMB.diagnosticoSelect.descripcion}" size="36" tabindex="4"  />
                                                                
                            </p:panelGrid>
                            
                            <br/>
                            <div style="float:right">
                                <p:commandButton value="Cancelar" 
                                                 oncomplete="PF('modalDiagnostico').hide();" ajax="true" />
                                &nbsp;&nbsp;
                                <p:commandButton value="Guardar"  styleClass="btnMusAzul" actionListener="#{diagnosticosMB.guardarDiagnostico}" 
                                                 onclick="PF('statusProcess').show()"  oncomplete="PF('statusProcess').hide();if(args.estatus){ PF('modalDiagnostico').hide();}" ajax="true" 
                                                 update=":mainForm:tblDiagnosticos" rendered="#{!diagnosticosMB.actualizar}"/>
                                <p:commandButton value="Modificar"  styleClass="btnMusAzul" actionListener="#{diagnosticosMB.actualizarDiagnostico()}" 
                                                 onclick="PF('statusProcess').show()"  oncomplete="PF('statusProcess').hide();if(args.estatus){ PF('modalDiagnostico').hide();}" ajax="true" 
                                                 update=":mainForm:tblDiagnosticos" rendered="#{diagnosticosMB.actualizar}"/>
                                &nbsp;
                            </div>
                        </h:form>
                    </p:dialog>    
                </div>    
            
            </ui:define>

        </ui:composition>

    </h:body>

</html>
