<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"    
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <ui:composition template="../template/mainLayout.xhtml">
            <ui:define name="content">
                <div class="mainPanel" style="border: none;">
                    <h:form id="mainForm">                    
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" closeOnEscape="true" >
                            <p:commandButton value="Si" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                            <p:commandButton value="No" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                        </p:confirmDialog>
                        <div id="busqueda" style="padding-bottom: 0px;">
                            <p:outputLabel value="Solicitud de Insumos"  style="color: #FFFFFF;font-size: 18px !important;font-weight: bold;margin-right: 20px;" />
                            <p:outputLabel value="Almacén:"  style="color: #FFFFFF;font-size: medium !important;font-weight: bold;margin-right: 10px;" />
                            <p:outputLabel value="#{solicitudInsumoServicioMB.estructuraSelect.nombre}"  style="color: #FFFFFF;font-size: medium !important;font-weight: bold;margin-right: 50px;" rendered="#{!solicitudInsumoServicioMB.isAdmin}" />
                            <p:selectOneMenu style="width: 150px;vertical-align: middle;margin-right: 10px;" value="#{solicitudInsumoServicioMB.tipoAlmacen}" 
                                             rendered="#{solicitudInsumoServicioMB.isAdmin}" filter="true" filterPlaceholder="Nombre Servicio"  >
                                <p:ajax listener="#{solicitudInsumoServicioMB.buscarReabasto}" 
                                        update=":mainForm:tblSolicitudesCtrl" />
                                <f:selectItems value="#{solicitudInsumoServicioMB.estructuraList}" var="tipo" itemLabel="#{tipo.nombre}" itemValue="#{tipo.idEstructura}" />                                

                            </p:selectOneMenu>
                            <p:inputText id="textSearch" style="margin-top:20px;width: 40%!important;" 
                                         value="#{solicitudInsumoServicioMB.cadenaBusqueda}" class="textSearch" placeholder="Buscar por: Folio, Fecha, Estatus, Solicitante" />
                            <i class="iconSearch">
                                <img src="../../resources/img/Medicamento/search-lupa.png" title="Presiona para buscar" alt="15"/>                                
                            </i>                            
                            <p:commandButton title="Buscar" value="Buscar" icon="ui-icon-search" actionListener="#{solicitudInsumoServicioMB.buscarReabasto()}"
                                             update=":mainForm" ajax="false" validateClient="true" onclick="PF('statusProcess').show();"
                                             oncomplete="PF('statusProcess').hide();" style=" margin-left: 20px; margin-bottom: 8px;" />
                        </div>
                        <p:commandButton class="btnNew" value="Crear Solicitud" disabled="#{solicitudInsumoServicioMB.btnNew}" icon="fa fa-file-o" rendered="#{solicitudInsumoServicioMB.permiso.puedeCrear}"
                                         onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide(); PF('mdlTipoColectivo').show();" update="frmTipoReabasto"
                                         ajax="true"  style=" margin: 5px 0; " styleClass="btnMusAzul" />                                                            
                        <br/>
                        <p:messages id="validaMsg" class="validaMsg" globalOnly="true" rendered="#{solicitudInsumoServicioMB.messaje}" closable="true" showDetail="false" >
                            <p:autoUpdate />
                        </p:messages>

                        <p:dataTable emptyMessage="No se encontraron registros" rows="10"
                                     paginatorTemplate=" {CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     currentPageReportTemplate=" "
                                     paginator="true"  reflow="true"                                       
                                     paginatorPosition="bottom" widgetVar="tblSolicitudesCtrl" 
                                     value="#{solicitudInsumoServicioMB.solicitudReabastoLazy}" var="item" 
                                     lazy="true" id="tblSolicitudesCtrl" scrollable="true" scrollWidth="100%" scrollHeight="350"
                                     style="margin-bottom:5px; text-align: center;" selectionMode="single" 
                                     selection="#{solicitudInsumoServicioMB.reabastoSelect}"
                                     rowKey="#{item.idReabasto}" rowIndexVar="row">
                            <p:ajax event="rowDblselect" oncomplete="PF('mdlNewColectivo').show();" 
                                    update=":frmNewReabasto" listener="#{solicitudInsumoServicioMB.obtenerDetalleInsumos}"/>
                            <p:column style="text-align: left;"   headerText="Folio" width="15%" sortBy="#{item.folio}">
                                <h:outputText value="#{item.folio}" class="" />
                            </p:column>

                            <p:column style="text-align: left;"  headerText="Fecha"  width="15%" sortBy="#{item.fechaSolicitud}">
                                <h:outputText value="#{item.fechaSolicitud}" class="" >
                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy HH:mm a" />
                                </h:outputText>
                            </p:column>

                            <p:column style="text-align: left !important; "  headerText="Estatus"  width="20%" sortBy="#{item.estatus}">
                                <h:outputText value="#{item.estatus}"   class="" />
                            </p:column>                            

                            <p:column style="text-align: left;"  headerText="Area Solicitante"  width="20%" sortBy="#{item.almacen}">
                                <h:outputText value="#{item.almacen}" class="" />
                            </p:column>
                            <p:column style="text-align: left;"  headerText="Usuario Solicitante"  width="20%" sortBy="#{item.solicitante}">
                                <h:outputText value="#{item.solicitante}"  class="" />
                            </p:column>

                            <p:column style="text-align: left;" headerText="Acciones"  width="10%">
                                <ui:remove><p:commandLink title="Detalle"  actionListener="#{solicitudInsumoServicioMB.obtenerReabastoInsumo(item.idReabasto)}"
                                                          onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();PF('mdlNewColectivo').show();" 
                                                          update=":frmNewReabasto" >
                                        <i class="fa fa-edit iconMusAzul" />
                                    </p:commandLink>&nbsp;</ui:remove>


                                <p:commandLink title="Eliminar"  actionListener="#{solicitudInsumoServicioMB.deleteReabasto(item.idReabasto)}"  rendered="#{(item.idEstatusReabasto == 1 ) ? 'true' : 'false'}"
                                               onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();" update=":mainForm:tblSolicitudesCtrl" >
                                    <i class="fa fa-trash-o iconMusAzul" />
                                    <p:confirm header="Eliminación del Reabasto" message="Realmente desea Eliminar la solicitud" icon="ui-icon-alert"  />
                                </p:commandLink>&nbsp;
                                <p:commandLink title="Cancelar"  actionListener="#{solicitudInsumoServicioMB.cancelReabastoOfList(item.idReabasto)}"  rendered="#{(item.idEstatusReabasto == 2) ? 'true' : 'false'}"
                                               onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();" update=":mainForm:tblSolicitudesCtrl" >
                                    <i class="fa fa-ban iconMusAzul" />
                                    <p:confirm header="Cancelación del Reabasto" message="Realmente desea cancelar la solicitud" icon="ui-icon-alert"  />
                                </p:commandLink>&nbsp;

                                <p:commandLink title="Imprimir"  actionListener="#{solicitudInsumoServicioMB.printOrdenReabasto(item)}" update=":formPDF"
                                               onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();if(args.estatus){PF('mdlReport').show();}" >
                                    <i class="fa fa-print iconMusAzul" />                                    
                                </p:commandLink>&nbsp;

                                <p:commandLink title="Enviar solicitud a SIAM"  rendered="#{(item.idEstatusReabasto == 1 ) ? 'true' : 'false'}"
                                               actionListener="#{solicitudInsumoServicioMB.reenviarSolicitudSIAM(item)}" update=":formPDF,:mainForm:tblSolicitudesCtrl"
                                               onclick="PF('statusProcess').show();" oncomplete="if(args.estatus){PF('mdlReport').show();}PF('statusProcess').hide();" >
                                    <i class="fa fa-paper-plane iconMusAzul" />                                    
                                </p:commandLink>&nbsp;
                                
                                <p:commandLink title="Consultar Colectivo" rendered="#{solicitudInsumoServicioMB.colectivoXServicio ? true:false}"
                                               actionListener="#{solicitudInsumoServicioMB.consultarColectivoSIAM(item)}" update=":formConsultaColectivo"
                                               onclick="PF('statusProcess').show();" oncomplete="if(args.estatus){PF('mdlConsultaColectivo').show();}PF('statusProcess').hide();" >
                                    <i class="fa fa-eye iconMusAzul" />                                    
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>
                    </h:form>

                    <p:dialog header="Seleccione el tipo de Orden de Reabasto"
                              widgetVar="mdlTipoColectivo"
                              closeOnEscape="true" modal="true"                          
                              style="font-size:xx-small !important; " >
                        <h:form id="frmTipoReabasto">
                            <p:messages id="validaMsg1" globalOnly="false" closable="true" showDetail="false" >
                                <p:autoUpdate />
                            </p:messages>
                            <p:fieldset  legend="Normal / Extraordinaria" >
                                <p:selectOneRadio id="tipoReabasto" layout="pageDirection" value="#{solicitudInsumoServicioMB.tipoOrden}" required="true" requiredMessage="Debe seleccionar un tipo de Orden" >
                                    <f:selectItem itemLabel="Reabasto Normal" itemValue="1"  />
                                    <f:selectItem itemLabel="Reabasto Extraordinaria" itemValue="2" />
                                    <f:ajax render="frmTipoReabasto" execute="tipo" />
                                </p:selectOneRadio>
                            </p:fieldset> <br />
                            <p:outputLabel value="Tipo de Insumo" /> &nbsp;&nbsp;
                            <p:selectOneMenu style="width: 120px;" value="#{solicitudInsumoServicioMB.tipoInsumo}"  >
                                <f:selectItems value="#{solicitudInsumoServicioMB.tipoInsumoList}" var="tipo" itemLabel="#{tipo.nombreCatalogo}" itemValue="#{tipo.idCatalogoGeneral}" />
                            </p:selectOneMenu>
                            <p:panel class="pnlActions">
                                <p:commandButton id="btnTipCancel" class="btnItem" value="Cancelar"  style="width: 100px;"
                                                 ajax="true" onclick="PF('mdlTipoColectivo').hide();"  validateClient="false" />&nbsp;&nbsp;
                                <p:commandButton id="btnTipNew" class="btnItem"
                                                 value="Crear" style="margin:0; width: 100px; "
                                                 actionListener="#{solicitudInsumoServicioMB.newOrdenReabasto}"
                                                 onclick="PF('statusProcess').show();"
                                                 update="frmNewReabasto" styleClass="btnMusAzul"
                                                 oncomplete="if(args.estatus){ PF('mdlTipoColectivo').hide(); PF('mdlNewColectivo').show();}PF('statusProcess').hide();"
                                                 />
                            </p:panel>
                        </h:form>
                    </p:dialog>

                    <p:dialog header="Orden de Reabasto de Insumos"
                              widgetVar="mdlNewColectivo" id="mdlNewColectivo"
                              closeOnEscape="true" modal="true" height="90%"                          
                              style="font-size:xx-small !important; " width="85%">
                        <h:form id="frmNewReabasto">
                            <p:messages globalOnly="false" closable="true" showDetail="false" rendered="#{solicitudInsumoServicioMB.msjMdlSurtimiento}" >
                                <p:autoUpdate />
                            </p:messages>
                            <p:panelGrid>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel value="Tipo de Solicitud:"  />        
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.tipoOrden==1 ? 'Normal':'Extraordinario'}" style="font-weight: bolder;" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="Fecha:"   />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.reabastoSelect.fechaSolicitud}" style="font-weight: bolder;" >
                                            <f:convertDateTime type="date" pattern="dd/MM/yyyy HH:mm a" />
                                        </p:outputLabel>
                                    </p:column>
                                    <p:column></p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel value="Almacén Solicitante:" />        
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.reabastoSelect.almacen}"  style="font-weight: bolder;" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="Proveedor:" />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu style="width: 185px;"  value="#{solicitudInsumoServicioMB.reabastoSelect.idProveedor}"  rendered="#{solicitudInsumoServicioMB.activo}"  tabindex="4" >
                                            <f:selectItem itemLabel="Seleccione una opción" itemValue="" noSelectionOption="true"  />
                                            <f:selectItems value="#{solicitudInsumoServicioMB.provList}" var="prov" itemLabel="#{prov.nombreProveedor}" itemValue="#{prov.idProveedor}" />                            
                                        </p:selectOneMenu>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.reabastoSelect.proveedor}" rendered="#{!solicitudInsumoServicioMB.activo}" style="font-weight: bolder;" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="Destino:" rendered="#{solicitudInsumoServicioMB.destinoCole}" />
                                    </p:column>
                                    <p:column>
                                        <p:selectOneMenu style="width: 185px;"  value="#{solicitudInsumoServicioMB.reabastoSelect.destino}"  rendered="#{solicitudInsumoServicioMB.destinoCole}"  tabindex="4" >
                                            <f:selectItem itemLabel="Seleccione una opción" itemValue="" noSelectionOption="true"  />
                                            <f:selectItems value="#{solicitudInsumoServicioMB.serviciosList}" var="dest" itemLabel="#{dest.nombre}" itemValue="#{dest.idEstructura}" />                            
                                        </p:selectOneMenu> 
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{solicitudInsumoServicioMB.orgdes}" >
                                    <p:column>
                                        <p:outputLabel value="Origen"/>
                                    </p:column>
                                    <p:column>
                                        <p:inputText size="25" value="#{solicitudInsumoServicioMB.origen}" tabindex="6" style="font-weight: bolder;" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="Destino" />
                                    </p:column>
                                    <p:column>
                                        <p:inputText size="25" value="#{solicitudInsumoServicioMB.destino}"  tabindex="7" style="font-weight: bolder;" />
                                    </p:column>      
                                    <p:column></p:column>
                                </p:row>
                            </p:panelGrid>   
                            <p:panelGrid id="addInsumo" rendered="#{solicitudInsumoServicioMB.contEdit}" >
                                <div  style="background-color:grey  !important; padding: 5px;  ">
                                    <p:outputLabel value="Cantidad" style="color:#fff" />&nbsp;&nbsp;
                                    <p:inputText id="numSoli" value="#{solicitudInsumoServicioMB.cantSolicitada}" size="7"  tabindex="8" >
                                        <p:keyFilter regEx="#{solicitudInsumoServicioMB.regexNumber}"  />                                
                                    </p:inputText> &nbsp;&nbsp;
                                    <p:outputLabel value="Insumo"  style="color:#fff" /> &nbsp;&nbsp;
                                    <p:autoComplete id="txtInsumo" 
                                                    class="autoComplete-Sum" 
                                                    styleClass="autoComplete-Sum" 
                                                    panelStyle="autoComplete-Sum" 
                                                    inputStyleClass="autoComplete-Sum" 
                                                    value="#{solicitudInsumoServicioMB.medicamento}"
                                                    completeMethod="#{solicitudInsumoServicioMB.autoComplete}"
                                                    minQueryLength="4" scrollHeight="350" 
                                                    queryDelay="500" 
                                                    maxResults="50" 
                                                    forceSelection="true" 
                                                    cacheTimeout="0" 
                                                    var="insumo" 
                                                    placeholder="Buscar Insumos" 
                                                    cache="false"
                                                    emptyMessage="No se encontraron registros"
                                                    itemLabel="#{insumo.nombreCorto}" itemValue="#{insumo}" 
                                                    converter="insumoConverter"
                                                    tabindex="9" >
                                        <p:ajax event="itemSelect" listener="#{solicitudInsumoServicioMB.handleSelect}" update="btnAdd,lstService" ></p:ajax>
                                        <p:ajax event="itemUnselect" listener="#{solicitudInsumoServicioMB.handleUnSelect}" update="btnAdd" ></p:ajax>
                                        <p:column style="width: 20px; font-size: small;" width="20px">
                                            <f:facet name="header" >
                                                <h:outputText value="Clave Institucional" />
                                            </f:facet>
                                            <h:outputText value="#{insumo.claveInstitucional}" style=" font-size: small;" />
                                        </p:column>
                                        <p:column style="width: 350px; font-size: small;" width="350px">
                                            <f:facet name="header" >
                                                <h:outputText value="Descripción" />
                                            </f:facet>
                                            <h:outputText value="#{insumo.nombreCorto}" style=" font-size: x-small;" />
                                        </p:column>
                                    </p:autoComplete> &nbsp;&nbsp;
                                    <p:outputLabel value="Servicio:" rendered="#{!solicitudInsumoServicioMB.destinoCole}" style="color:#fff" /> &nbsp;&nbsp;
                                    <p:selectOneMenu  id="lstService" style="width: 185px;"  value="#{solicitudInsumoServicioMB.idServiceAdd}"  rendered="#{!solicitudInsumoServicioMB.destinoCole}"  tabindex="10" >
                                        <f:selectItem itemLabel="Seleccione una opción" itemValue="" noSelectionOption="true"  />
                                        <f:selectItems value="#{solicitudInsumoServicioMB.serviciosItemList}" var="dest" itemLabel="#{dest.nombre}" itemValue="#{dest.idEstructura}" />                            
                                    </p:selectOneMenu>&nbsp;&nbsp;
                                    <p:commandButton id="btnAdd"  tabindex="11"  rendered="#{!solicitudInsumoServicioMB.destinoCole}"
                                                     value="Agregar" style="margin:0; width:100px;"
                                                     actionListener="#{solicitudInsumoServicioMB.addOrdenReabasto}"
                                                     onclick="PF('statusProcess').show();"  update="frmNewReabasto,formAlert"                                       
                                                     oncomplete="if(!args.estatus){PF('mdlAutorizacion').show();} PF('statusProcess').hide();"
                                                     /> 
                                    <p:commandButton id="btnAdd2"  tabindex="11"  rendered="#{solicitudInsumoServicioMB.destinoCole}"
                                                     value="Agregar" style="margin:0; width:100px;"
                                                     actionListener="#{solicitudInsumoServicioMB.addOrdenReabastoExt}"
                                                     onclick="PF('statusProcess').show();"  update="frmNewReabasto,formAlert"                                       
                                                     oncomplete="PF('statusProcess').hide();"
                                                     />
                                </div>
                            </p:panelGrid>
                            <p:dataTable id="tblReabastoInsumo" 
                                         var="item" editable="#{solicitudInsumoServicioMB.contEdit}" editMode="cell"
                                         value="#{solicitudInsumoServicioMB.insumoList}" 
                                         styleClass="styleEventosPlanPrestacion" reflow="true"
                                         style="margin-bottom:5px;" scrollRows="250" scrollable="true" liveScroll="true" scrollHeight="350" >

                                <p:ajax event="cellEdit" listener="#{solicitudInsumoServicioMB.onCellEdit}" update="tblReabastoInsumo,formAlert" oncomplete="if(!args.estatus){PF('mdlAutorizacion').show();}" />                                
		
                                <p:column style="width:5%" rendered="#{solicitudInsumoServicioMB.showExpansion}">
                                    <p:rowToggler/>
                                </p:column>
                                
                                <ui:remove>
                                    <p:column style="text-align: left; width: 10%" headerText="Folio SIAM" rendered="#{solicitudInsumoServicioMB.mostrarFolioAlternativo and !solicitudInsumoServicioMB.nuevaOrden}">
                                        <h:outputText value="#{item.folioAlternativo}" class="altoColumn" />
                                    </p:column>
                                </ui:remove>

                                <p:column style="text-align: left; width: 10%;"  headerText="Clave">
                                    <h:outputText value="#{item.clave}"  class="altoColumn" />
                                </p:column>

                                <p:column style="text-align: left;width: 30%;"  sortBy="#{item.nombreLargo}" headerText="Insumo" >
                                    <h:outputText value="#{item.nombreComercial}" class="altoColumn" id="nombreComercial"/>
                                    <p:tooltip value="#{item.nombreComercial}"
                                               for="nombreComercial"
                                               position="top"/>
                                </p:column>

                                <p:column style="text-align: left !important;width: 8%; " headerText="Presentación" sortBy="#{item.presentacion}" >
                                    <h:outputText value="#{item.presentacion}"   class="altoColumn" />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;"  headerText="Piezas X caja">
                                    <h:outputText value="#{item.piezasCaja}"   class="altoColumn" />
                                </p:column>

                                <ui:remove> <p:column style="text-align: left;width: 5%;"  headerText="Mínimo"  rendered="#{solicitudInsumoServicioMB.pointCtrl}" >
                                    <h:outputText value="#{item.minimo}" id="tblColMinimo"  class="altoColumn" />
                                    <p:tooltip value="Número de Piezas Mínimas en Dósis Unitaria" 
                                               for="tblColMinimo" 
                                               position="bottom"  />
                                </p:column></ui:remove>

                                <p:column style="text-align: left;width: 5%;"  headerText="Reorden" rendered="#{solicitudInsumoServicioMB.pointCtrl}" >
                                    <h:outputText value="#{item.reorden}" id="tblColReorden" class="altoColumn"  />
                                    <p:tooltip value="Punto de Reorden en Dósis Unitaria" 
                                               for="tblColReorden" 
                                               position="bottom"  />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;"  headerText="Máximo"  rendered="#{solicitudInsumoServicioMB.pointCtrl}" >
                                    <h:outputText value="#{item.maximo}" id="tblColMaximo" class="altoColumn"  />
                                    <p:tooltip value="Número de Piezas Máximas en Dósis Unitaria" 
                                               for="tblColMaximo" 
                                               position="bottom" />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;" headerText="Cant X Lotes" rendered="#{solicitudInsumoServicioMB.campoCantidadXLote}" >
                                    <h:outputText value="#{item.cantidadActual}"  class="altoColumn" />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;" headerText="Cant X Clave" rendered="#{solicitudInsumoServicioMB.campoCantidadXClave}">
                                    <h:outputText value="#{item.cantidadPorClave}"  class="altoColumn" />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;"  headerText="Dotación Diaria" rendered="#{solicitudInsumoServicioMB.dotacionDiaria}">
                                    <h:outputText value="#{item.dotacion}" id="tblColDotacion" class="altoColumn"  />
                                    <p:tooltip value="Dotación Díaria en Dósis Unitaria" 
                                               for="tblColDotacion" 
                                               position="bottom" />
                                </p:column>

                                <p:column style="text-align: left;width: 5%;" headerText="Existencia SIAM" rendered="#{solicitudInsumoServicioMB.campSiam}" >
                                    <h:outputText value="#{item.cantidadPorClave}" id="tblCantActSIAM" class="altoColumn" />
                                    <p:tooltip value="Existencia Actual en SIAM - Presentación unidosis" 
                                               for="tblCantActSIAM" 
                                               position="bottom" />
                                </p:column>
                                <p:column style="text-align: left;width: 5%;" headerText="Cantidad Actual" >
                                    <h:outputText value="#{item.cantidadActual}" id="tblColCantAct" class="altoColumn" />
                                    <p:tooltip value="Cantidad de Existencias Actual en Dósis Unitaria" 
                                               for="tblColCantAct" 
                                               position="bottom" />
                                </p:column>

                                <p:column style="text-align: left;width: 6%;" sortBy="#{item.cantidadSolicitada}" headerText="Cantidad Solicitada" >
                                    <h:outputText value="#{item.cantidadSolicitada}" id="tblColCantSol0" class="altoColumn" title="Cantidad Requerida" style="font-weight: bolder;" rendered="#{solicitudInsumoServicioMB.colectivoXServicio ? !solicitudInsumoServicioMB.destinoCole:false}" /> 
                                    <p:cellEditor disabled="#{(item.nivelSurt&gt;2 and solicitudInsumoServicioMB.tipoOrden == 1) ? true : false}"                                                 
                                                  rendered="#{solicitudInsumoServicioMB.colectivoXServicio ? solicitudInsumoServicioMB.destinoCole:true}">
                                        <f:facet name="output">
                                            <h:outputText value="#{item.cantidadSolicitada}" id="tblColCantSol" class="altoColumn" title="Cantidad Requerida" style="font-weight: bolder;" /> 
                                            <p:tooltip value="Cantidad Requerida" 
                                                       for="tblColCantSol" 
                                                       position="bottom" />
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputNumber value="#{item.cantidadSolicitada}"  padControl="false" style="width:90%" label="Cantidad Solicitada"/>                                                
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>                                

                                <p:column style="text-align: left;width: 5%;" headerText="Acciones" rendered="#{solicitudInsumoServicioMB.contEdit}">
                                    <p:commandLink title="Eliminar"  actionListener="#{solicitudInsumoServicioMB.deleteInsumoOfList(item.idInsumo)}"  rendered="#{solicitudInsumoServicioMB.contEdit}"
                                                   onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();" update="tblReabastoInsumo" >
                                        <i class="fa fa-trash-o fa-lg iconMusAzul" />
                                    </p:commandLink>
                                    <p:spacer width="10px" height="5px" />
                                    <p:outputLabel rendered="#{item.nivelSurt==1 ? true : false}"><i class="fa fa-circle-o fa-lg iconMusAzul" title="Pendiente por Surtir" /></p:outputLabel>
                                    <p:outputLabel rendered="#{item.nivelSurt==2 ? true : false}"><i class="fa fa-adjust  fa-rotate-90 fa-lg iconMusAzul" title="Surtido Parcial"></i></p:outputLabel>
                                    <p:outputLabel rendered="#{item.nivelSurt==3 ? true : false}"><i class="fa fa-check-circle fa-lg iconMusVerde" title="Surtido Completo"></i></p:outputLabel>
                                    <p:outputLabel rendered="#{item.nivelSurt==4 ? true : false}"><i class="fa fa-check-circle fa-lg iconMusRojo" title="Surtido Extra"></i></p:outputLabel>

                                </p:column>

                                <p:rowExpansion rendered="#{solicitudInsumoServicioMB.showExpansion}">
                                    <p:dataTable var="det" scrollable="true" value="#{item.detalleInsumo}"  
                                                 editable="true" editMode="cell" rowKey="#{item.idInsumo}"                                         
                                         styleClass="styleEventosPlanPrestacion" reflow="true"
                                         style="margin-bottom:5px;" scrollRows="150" liveScroll="true" scrollHeight="250">    
                                        <p:ajax event="cellEdit" listener="#{solicitudInsumoServicioMB.onCellEditDetalle}" update="frmNewReabasto:tblReabastoInsumo" oncomplete="if(args.estatus){PF('mdlAutorizacion').show();}" />

                                        <p:column headerText="Servicio" style="width: 10%">
                                            <h:outputText value="#{det.servicio}" />                                            
                                        </p:column>
                                        <p:column headerText="Reorden" style="width: 10%">
                                            <h:outputText value="#{det.reorden}" />
                                        </p:column>
                                        <p:column headerText="Máximo" style="width: 10%">
                                            <h:outputText value="#{det.maximo}" />
                                        </p:column>
                                        <p:column headerText="Cantidad Actual" style="width: 10%">
                                            <h:outputText value="#{det.cantidadActual}" />
                                        </p:column>
                                        <p:column headerText="Cantidad Solicitada" style="width: 10%">
                                            <p:cellEditor>
                                                <f:facet name="output">
                                                    <h:outputText value="#{det.cantidadSolicitada}" id="tblColCantSolDet" class="altoColumn" style="font-weight: bolder;" /> 
                                                    <p:tooltip value="Cantidad Solicitada" 
                                                               for="tblColCantSolDet" 
                                                               position="bottom" />
                                                </f:facet>
                                                <f:facet name="input">
                                                    <p:inputNumber value="#{det.cantidadSolicitada}" valueChangeListener="#{solicitudInsumoServicioMB.setItemSelect(item)}"
                                                                   padControl="false" style="width:90%" label="Cantidad Solicitada">                                                        
                                                    </p:inputNumber>
                                                </f:facet>
                                            </p:cellEditor>
                                        </p:column>
                                        <p:column headerText="Acciones" style="width: 10%">
                                            <p:commandLink title="Eliminar"  actionListener="#{solicitudInsumoServicioMB.deleteServiceOfList(item.idInsumo,det.idEstructura)}" 
                                                   onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();" update="frmNewReabasto:tblReabastoInsumo" >
                                                <i class="fa fa-trash-o fa-lg iconMusAzul" />
                                            </p:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </p:rowExpansion>
                                
                                <f:facet name="footer" >
                                    <p:outputLabel style="font-size: 1em !important; color: #000; ">
                                        #{solicitudInsumoServicioMB.numeroRegistros} Insumo registrado
                                    </p:outputLabel>
                                </f:facet>
                            </p:dataTable>
                            <p:panel class="pnlActions">
                                <p:commandButton id="btnRegPrint" class="btnItem" value="Imprimir" style="width: 100px;"  rendered="#{!solicitudInsumoServicioMB.contEdit}"
                                                 ajax="true" onclick="PF('statusProcess').show();" validateClient="false"  update=":formPDF"  tabindex="11"
                                                 actionListener="#{solicitudInsumoServicioMB.printOrdenReabasto(solicitudInsumoServicioMB.reabastoSelect)}"                                             
                                                 oncomplete="PF('mdlReport').show();PF('mdlNewColectivo').hide(); PF('statusProcess').hide();" />&nbsp;&nbsp;
                                <p:commandButton id="btnRegCancel" class="btnItem" value="Cancelar" style="width: 100px;"   tabindex="12"
                                                 ajax="true" onclick="PF('mdlNewColectivo').hide();"  validateClient="false" />&nbsp;&nbsp;
                                <p:commandButton id="btnRegNew"  rendered="#{solicitudInsumoServicioMB.contEdit}" styleClass="btnMusAzul"  tabindex="13"
                                                 value="Crear" style="margin:0; width: 100px;"                                        
                                                 onclick="PF('statusProcess').show();" actionListener="#{solicitudInsumoServicioMB.validaProveedor}"
                                                 oncomplete="if(args.estatus){PF('mdlConfColectivo').show();} PF('statusProcess').hide();" />
                            </p:panel>
                        </h:form>
                    </p:dialog>

                    <p:dialog  header="Confirmación de Orden de Reabasto"
                               widgetVar="mdlConfColectivo"
                               closeOnEscape="true" modal="true"                          
                               style="font-size:xx-small !important;" >
                        <h:form id="frmConfReabasto">
                            <p:panelGrid columns="2" >
                                <p:outputLabel value="Imprimir Solicitud" />
                                <p:selectOneButton value="#{solicitudInsumoServicioMB.printSolicitud}">
                                    <f:selectItem itemLabel="Si" itemValue="true" />
                                    <f:selectItem itemLabel="No" itemValue="false" />
                                </p:selectOneButton>
                            </p:panelGrid><br />
                            <div class="pnlActions">
                                <p:commandButton id="btnConfCancel" class="btnItem" value="Cancelar" style="width: 100px;" 
                                                 ajax="true" onclick="PF('mdlConfColectivo').hide();"  validateClient="false" />&nbsp;&nbsp;

                                <p:commandButton id="btnConfSave" value="Guardar" style="margin:0; width: 100px;"
                                                 actionListener="#{solicitudInsumoServicioMB.sendOrdenReabasto(2)}"
                                                 onclick="PF('statusProcess').show();" update=":mainForm:tblSolicitudesCtrl,:formPDF"
                                                 oncomplete="PF('mdlConfColectivo').hide(); PF('mdlNewColectivo').hide(); PF('statusProcess').hide();if(args.estatus){ PF('mdlReport').show();}" />&nbsp;&nbsp;

                                <p:commandButton id="btnConfSend" value="Enviar" style="margin:0; width: 100px;"
                                                 actionListener="#{solicitudInsumoServicioMB.sendOrdenReabasto(1)}"
                                                 onclick="PF('statusProcess').show();" update=":mainForm:tblSolicitudesCtrl,:formPDF"
                                                 oncomplete="PF('mdlConfColectivo').hide(); PF('mdlNewColectivo').hide();  PF('statusProcess').hide();if(args.estatus){ PF('mdlReport').show();} " />
                            </div>
                        </h:form>
                    </p:dialog>

                    <p:dialog widgetVar="mdlReport" width="800"  height="560" minimizable="true" maximizable="true" closable="true"
                              closeOnEscape="true" modal="true"                          
                              style="font-size:xx-small !important;" >                        
                        <h:form id="formPDF">                        
                            <p:messages id="msgPrint" class="validaMsg" globalOnly="false"  closable="true" showDetail="false"  />
                            <p:media cache="false" width="100%" height="550" value="/Reportes" player="pdf"/>                         
                        </h:form>
                        <p:ajax event="close" listener="#{sesionMB.freeBytesFromSession()}"/>
                    </p:dialog>

                    <p:dialog header="ALERTA" id="idAlert"
                              widgetVar="mdlAutorizacion"
                              closeOnEscape="false"  resizable="false"
                              closable="false" styleClass="dlgAutoritation"
                              modal="true" style="align-content: center" >
                        <h:form id="formAlert">
                            <p:messages id="msgAuthorization" globalOnly="false" showDetail="false" closable="true" />
                            <div class="panelAlertYellow" style="height: 40px;" align="center" >
                                <h:outputText value="#{solicitudInsumoServicioMB.msjAlert}"  escape="false"/>
                            </div>
                            <br/>
                            <div align="center">
                                <h:outputText value="RESPONSABLE"  class="textoNegrita" />
                            </div>                        
                            <div class="ui-g">
                                <div class="ui-g-12">
                                    <div class="ui-g-12 ui-md-6 ui-lg-1">
                                        <p:outputLabel style="margin-right: 10px;" value="Nombre:" />
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4" style="width: 470px !important;">
                                        <p:inputText  value="#{solicitudInsumoServicioMB.nombreCompleto}"  size="55" readonly="true"   ></p:inputText>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-1" style="width: 90px !important; border: #000 1 solid !important;">
                                        <p:commandButton value="Agregar" 
                                                         styleClass="btnMusAzul"  rendered="false"
                                                         icon="fa fa-plus"
                                                         style="margin-right: 10px;float: right;" />
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-2" style="width: 90px !important;">
                                        <p:commandButton value="Editar" rendered="false" 
                                                         styleClass="btnMusAzul" 
                                                         icon="fa fa-pencil"                                          
                                                         style="margin-right: 10px;float: right;" />
                                    </div>
                                </div>
                            </div>  
                            <br/>
                            <div align="center">
                                <h:outputText value="AUTORIZADOR"  class="textoNegrita" />
                            </div>                        
                            <div class="ui-g">
                                <div class="ui-g-12">
                                    <div class="ui-g-12 ui-md-8 ui-lg-1">
                                        <p:outputLabel style="margin-right: 10px;" value="Usuario:" />
                                    </div>
                                    <div class="ui-g-12 ui-md-8 ui-lg-3">
                                        <p:inputText value="#{solicitudInsumoServicioMB.userResponsable}"  size="15"   > </p:inputText>
                                    </div>
                                    <div class="ui-g-12 ui-md-8 ui-lg-1" style="width: 80px !important;">
                                        <p:outputLabel style="margin-right:0px;" value="Contraseña:" />
                                    </div>
                                    <div class="ui-g-12 ui-md-8 ui-lg-4" style="width: 250px !important;">
                                        <p:inputText type="password"   value="#{solicitudInsumoServicioMB.passResponsable}"  size="15"   > </p:inputText>
                                    </div>
                                    <div class="ui-g-12 ui-md-8 ui-lg-1">
                                        <p:commandButton value="Autorizar" 
                                                         styleClass="btnMusVerde" 
                                                         icon="fa fa-check" 
                                                         onclick="PF('statusProcess').show()" update=":frmNewReabasto:tblReabastoInsumo,:formAlert"
                                                         actionListener="#{solicitudInsumoServicioMB.authorization}" oncomplete="if(args.estatus){PF('mdlAutorizacion').hide();} PF('statusProcess').hide();"
                                                         style="margin-right: 10px;float: right;" >
                                        </p:commandButton>
                                    </div>
                                </div>
                            </div>  
                            <br/>
                            <p:commandButton value="Negar" rendered="false"
                                             styleClass="btnMusAzul" 
                                             icon="fa fa-check-circle"                        
                                             style="margin-right: 10px;float: right; width: 80px;"
                                             onclick="PF('statusProcess').show()"
                                             />

                            <p:commandButton value="Cancelar"                                 
                                             icon="fa fa-times-circle"
                                             onclick="PF('statusProcess').show()"
                                             actionListener="#{solicitudInsumoServicioMB.cancelAuthorization}"
                                             style="margin-right: 10px;float: right;"  update=":frmNewReabasto:tblReabastoInsumo"
                                             oncomplete="PF('statusProcess').hide(); PF('mdlAutorizacion').hide();"
                                             />  
                        </h:form>
                    </p:dialog>
               
                    <p:dialog header="CONSULTA COLECTIVO" id="idCole"
                              widgetVar="mdlConsultaColectivo"  width="60%"
                              closeOnEscape="true"  resizable="true"
                              closable="true" styleClass="dlgAutoritation"
                              modal="true" style="align-content: center" >
                        <h:form id="formConsultaColectivo">
                            <p:messages id="msgCole" class="validaMsg" globalOnly="true"  closable="true" showDetail="false" />
                            <p:panelGrid>
                                <p:row>
                                    <p:column>
                                        <p:outputLabel value="Folio:"  />        
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.reabastoSelect.folio}" style="font-weight: bolder;" />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="Fecha:"   />
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel value="#{solicitudInsumoServicioMB.reabastoSelect.fechaSolicitud}" style="font-weight: bolder;" >
                                            <f:convertDateTime type="date" pattern="dd/MM/yyyy HH:mm a" />
                                        </p:outputLabel>
                                    </p:column>
                                    <p:column></p:column>
                                </p:row>
                            </p:panelGrid>
                            <p:dataTable id="tblconsultaReabasto" 
                                         var="item" editable="false" editMode="cell"
                                         value="#{solicitudInsumoServicioMB.colectivosSIAM}" 
                                         styleClass="styleEventosPlanPrestacion" reflow="true"
                                         style="margin-bottom:5px;" scrollRows="150" scrollable="true" liveScroll="true" scrollHeight="250" >                                
                                
                                <p:column style="text-align: left; width: 40%;"  headerText="Servicio">
                                    <h:outputText value="#{item.servicio}"  class="altoColumn" />
                                </p:column>
                                
                                <p:column style="text-align: left; width: 30%;"  headerText="Folio">
                                    <h:outputText value="#{item.folioAlternativo}"  class="altoColumn" />
                                </p:column>
                                
                                <p:column style="text-align: left; width: 15%;"  headerText="Estatus">
                                    <h:outputText value="#{item.estatus}"  class="altoColumn" />
                                </p:column>
                                
                                <p:column style="text-align: left;" headerText="Acciones"  width="15%">
                                    <p:commandLink title="Imprimir"  actionListener="#{solicitudInsumoServicioMB.printOrdenReabastoServicioUnitario(item)}" update=":formPDF"
                                                   onclick="PF('statusProcess').show();" oncomplete="PF('statusProcess').hide();if(args.estatus){PF('mdlReport').show();}" >
                                        <i class="fa fa-print iconMusAzul" />                                    
                                    </p:commandLink>
                                    &nbsp;&nbsp;
                                    <p:selectBooleanCheckbox value="#{item.recibir}" disabled="#{item.folioAlternativo == null ? true:false}" />
                                    &nbsp;&nbsp;
                                <p:commandLink title="Enviar solicitud a SIAM"  rendered="#{(item.folioAlternativo == null ) ? 'true' : 'false'}"
                                               actionListener="#{solicitudInsumoServicioMB.reenviarServicioSIAM(item)}" update=":formPDF,:mainForm:tblSolicitudesCtrl,formConsultaColectivo:msgCole"
                                               onclick="PF('statusProcess').show();" oncomplete="if(args.estatus){PF('mdlReport').show();}PF('statusProcess').hide();" >
                                    <i class="fa fa-paper-plane iconMusAzul" />                                    
                                </p:commandLink>
                                </p:column>                                
                            </p:dataTable>

                            <p:commandButton value="Procesar"  
                                             styleClass="btnMusAzul"                                
                                             icon="fa fa-check-circle"
                                             style="margin-right: 10px;float: right;"
                                             onclick="PF('statusProcess').show()"
                                             actionListener="#{solicitudInsumoServicioMB.procesarColectivosSelect()}"
                                             update=":formConsultaColectivo:tblconsultaReabasto"
                                             oncomplete="PF('statusProcess').hide(); PF('mdlConsultaColectivo').hide();"
                                             /> 
                            
                            <p:commandButton value="Seleccionar todo" 
                                             icon="fa fa-check-circle-o"
                                             style="margin-right: 10px;float: right;"
                                             onclick="PF('statusProcess').show()"
                                             actionListener="#{solicitudInsumoServicioMB.selectAll()}"
                                             update=":formConsultaColectivo:tblconsultaReabasto"
                                             oncomplete="PF('statusProcess').hide();"
                                             />                            
                        </h:form>
                    </p:dialog>
                </div>
            </ui:define>
            <ui:define name="footer">

            </ui:define>
        </ui:composition>        
    </h:body>
</html>
