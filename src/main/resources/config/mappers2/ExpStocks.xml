<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.seidor.ulises.mapper.ExpStocksMapper" >
    <select id="obtener" resultType="com.seidor.ulises.model.ExpStocks" parameterType="com.seidor.ulises.model.ExpStocks" >
        SELECT id,
            articulo,
            lote,
            cantidad,
            cantEntr,
            cantSali,
            tipoAlmacen,
            almacen,
            pasillo,
            columna,
            nivel,
            posicion,
            version,
            tratado,
            fechaTratado,
            error,
            formato,
            fechaCaducidad,
            centro,
            almacenLogico,
            descripcion,
            rotacion,
            estatico,
            multiR,
            cantPendEnt,
            cantPendSal,
            estado,
            stockErp,
            datoExtra1,
            datoExtra2,
            datoExtra3,
            loteProveedor,
            loteFabricacion,
            propietario,
            matricula,
            sscc
        FROM expStocks
        WHERE 1=1
        <if test=" articulo != null ">
            AND articulo = #{ articulo , jdbcType = VARCHAR }
        </if>
        <if test=" lote != null ">
            AND lote = #{ lote , jdbcType = VARCHAR }
        </if>
        <if test=" cantidad != null ">
            AND cantidad = #{ cantidad , jdbcType = DOUBLE }
        </if>
        <if test=" cantEntr != null ">
            AND cantEntr = #{ cantEntr , jdbcType = DOUBLE }
        </if>
        <if test=" cantSali != null ">
            AND cantSali = #{ cantSali , jdbcType = DOUBLE }
        </if>
        <if test=" tipoAlmacen != null ">
            AND tipoAlmacen = #{ tipoAlmacen , jdbcType = VARCHAR }
        </if>
        <if test=" almacen != null ">
            AND almacen = #{ almacen , jdbcType = VARCHAR }
        </if>
        <if test=" pasillo != null ">
            AND pasillo = #{ pasillo , jdbcType = VARCHAR }
        </if>
        <if test=" columna != null ">
            AND columna = #{ columna , jdbcType = VARCHAR }
        </if>
        <if test=" nivel != null ">
            AND nivel = #{ nivel , jdbcType = VARCHAR }
        </if>
        <if test=" posicion != null ">
            AND posicion = #{ posicion , jdbcType = VARCHAR }
        </if>
        <if test=" version != null ">
            AND version = #{ version , jdbcType = INTEGER }
        </if>
        <if test=" tratado != null ">
            AND tratado = #{ tratado , jdbcType = VARCHAR }
        </if>
        <if test=" fechaTratado != null ">
            AND fechaTratado = #{ fechaTratado , jdbcType = TIMESTAMP }
        </if>
        <if test=" error != null ">
            AND error = #{ error , jdbcType = VARCHAR }
        </if>
        <if test=" formato != null ">
            AND formato = #{ formato , jdbcType = VARCHAR }
        </if>
        <if test=" fechaCaducidad != null ">
            AND fechaCaducidad = #{ fechaCaducidad , jdbcType = VARCHAR }
        </if>
        <if test=" centro != null ">
            AND centro = #{ centro , jdbcType = VARCHAR }
        </if>
        <if test=" almacenLogico != null ">
            AND almacenLogico = #{ almacenLogico , jdbcType = VARCHAR }
        </if>
        <if test=" descripcion != null ">
            AND descripcion = #{ descripcion , jdbcType = VARCHAR }
        </if>
        <if test=" rotacion != null ">
            AND rotacion = #{ rotacion , jdbcType = VARCHAR }
        </if>
        <if test=" estatico != null ">
            AND estatico = #{ estatico , jdbcType = VARCHAR }
        </if>
        <if test=" multiR != null ">
            AND multiR = #{ multiR , jdbcType = VARCHAR }
        </if>
        <if test=" cantPendEnt != null ">
            AND cantPendEnt = #{ cantPendEnt , jdbcType = DOUBLE }
        </if>
        <if test=" cantPendSal != null ">
            AND cantPendSal = #{ cantPendSal , jdbcType = DOUBLE }
        </if>
        <if test=" estado != null ">
            AND estado = #{ estado , jdbcType = VARCHAR }
        </if>
        <if test=" stockErp != null ">
            AND stockErp = #{ stockErp , jdbcType = DOUBLE }
        </if>
        <if test=" datoExtra1 != null ">
            AND datoExtra1 = #{ datoExtra1 , jdbcType = VARCHAR }
        </if>
        <if test=" datoExtra2 != null ">
            AND datoExtra2 = #{ datoExtra2 , jdbcType = VARCHAR }
        </if>
        <if test=" datoExtra3 != null ">
            AND datoExtra3 = #{ datoExtra3 , jdbcType = VARCHAR }
        </if>
        <if test=" loteProveedor != null ">
            AND loteProveedor = #{ loteProveedor , jdbcType = VARCHAR }
        </if>
        <if test=" loteFabricacion != null ">
            AND loteFabricacion = #{ loteFabricacion , jdbcType = VARCHAR }
        </if>
        <if test=" propietario != null ">
            AND propietario = #{ propietario , jdbcType = VARCHAR }
        </if>
        <if test=" matricula != null ">
            AND matricula = #{ matricula , jdbcType = VARCHAR }
        </if>
        <if test=" sscc != null ">
            AND sscc = #{ sscc , jdbcType = VARCHAR }
        </if>
        LIMIT 0, 1
    </select>

    <select id="obtenerLista" resultType="com.seidor.ulises.model.ExpStocks" parameterType="com.seidor.ulises.model.ExpStocks" >
        SELECT id,
            articulo,
            lote,
            cantidad,
            cantEntr,
            cantSali,
            tipoAlmacen,
            almacen,
            pasillo,
            columna,
            nivel,
            posicion,
            version,
            tratado,
            fechaTratado,
            error,
            formato,
            fechaCaducidad,
            centro,
            almacenLogico,
            descripcion,
            rotacion,
            estatico,
            multiR,
            cantPendEnt,
            cantPendSal,
            estado,
            stockErp,
            datoExtra1,
            datoExtra2,
            datoExtra3,
            loteProveedor,
            loteFabricacion,
            propietario,
            matricula,
            sscc
        FROM expStocks
        WHERE 1=1
        <if test=" articulo != null ">
            AND articulo = #{ articulo , jdbcType = VARCHAR }
        </if>
        <if test=" lote != null ">
            AND lote = #{ lote , jdbcType = VARCHAR }
        </if>
        <if test=" cantidad != null ">
            AND cantidad = #{ cantidad , jdbcType = DOUBLE }
        </if>
        <if test=" cantEntr != null ">
            AND cantEntr = #{ cantEntr , jdbcType = DOUBLE }
        </if>
        <if test=" cantSali != null ">
            AND cantSali = #{ cantSali , jdbcType = DOUBLE }
        </if>
        <if test=" tipoAlmacen != null ">
            AND tipoAlmacen = #{ tipoAlmacen , jdbcType = VARCHAR }
        </if>
        <if test=" almacen != null ">
            AND almacen = #{ almacen , jdbcType = VARCHAR }
        </if>
        <if test=" pasillo != null ">
            AND pasillo = #{ pasillo , jdbcType = VARCHAR }
        </if>
        <if test=" columna != null ">
            AND columna = #{ columna , jdbcType = VARCHAR }
        </if>
        <if test=" nivel != null ">
            AND nivel = #{ nivel , jdbcType = VARCHAR }
        </if>
        <if test=" posicion != null ">
            AND posicion = #{ posicion , jdbcType = VARCHAR }
        </if>
        <if test=" version != null ">
            AND version = #{ version , jdbcType = INTEGER }
        </if>
        <if test=" tratado != null ">
            AND tratado = #{ tratado , jdbcType = VARCHAR }
        </if>
        <if test=" fechaTratado != null ">
            AND fechaTratado = #{ fechaTratado , jdbcType = TIMESTAMP }
        </if>
        <if test=" error != null ">
            AND error = #{ error , jdbcType = VARCHAR }
        </if>
        <if test=" formato != null ">
            AND formato = #{ formato , jdbcType = VARCHAR }
        </if>
        <if test=" fechaCaducidad != null ">
            AND fechaCaducidad = #{ fechaCaducidad , jdbcType = VARCHAR }
        </if>
        <if test=" centro != null ">
            AND centro = #{ centro , jdbcType = VARCHAR }
        </if>
        <if test=" almacenLogico != null ">
            AND almacenLogico = #{ almacenLogico , jdbcType = VARCHAR }
        </if>
        <if test=" descripcion != null ">
            AND descripcion = #{ descripcion , jdbcType = VARCHAR }
        </if>
        <if test=" rotacion != null ">
            AND rotacion = #{ rotacion , jdbcType = VARCHAR }
        </if>
        <if test=" estatico != null ">
            AND estatico = #{ estatico , jdbcType = VARCHAR }
        </if>
        <if test=" multiR != null ">
            AND multiR = #{ multiR , jdbcType = VARCHAR }
        </if>
        <if test=" cantPendEnt != null ">
            AND cantPendEnt = #{ cantPendEnt , jdbcType = DOUBLE }
        </if>
        <if test=" cantPendSal != null ">
            AND cantPendSal = #{ cantPendSal , jdbcType = DOUBLE }
        </if>
        <if test=" estado != null ">
            AND estado = #{ estado , jdbcType = VARCHAR }
        </if>
        <if test=" stockErp != null ">
            AND stockErp = #{ stockErp , jdbcType = DOUBLE }
        </if>
        <if test=" datoExtra1 != null ">
            AND datoExtra1 = #{ datoExtra1 , jdbcType = VARCHAR }
        </if>
        <if test=" datoExtra2 != null ">
            AND datoExtra2 = #{ datoExtra2 , jdbcType = VARCHAR }
        </if>
        <if test=" datoExtra3 != null ">
            AND datoExtra3 = #{ datoExtra3 , jdbcType = VARCHAR }
        </if>
        <if test=" loteProveedor != null ">
            AND loteProveedor = #{ loteProveedor , jdbcType = VARCHAR }
        </if>
        <if test=" loteFabricacion != null ">
            AND loteFabricacion = #{ loteFabricacion , jdbcType = VARCHAR }
        </if>
        <if test=" propietario != null ">
            AND propietario = #{ propietario , jdbcType = VARCHAR }
        </if>
        <if test=" matricula != null ">
            AND matricula = #{ matricula , jdbcType = VARCHAR }
        </if>
        <if test=" sscc != null ">
            AND sscc = #{ sscc , jdbcType = VARCHAR }
        </if>
    </select>
        
    <update id="actualizar" parameterType="com.seidor.ulises.model.ExpStocks" >
        UPDATE expStocks SET
            tratado = #{ expStocks.tratado , jdbcType = VARCHAR }
            , fechaTratado = #{ expStocks.fechaTratado , jdbcType = TIMESTAMP }
        WHERE id = #{ expStocks.id , jdbcType = INTEGER }
    </update>

    <update id="actualizarLista" parameterType="java.util.List" useGeneratedKeys="false" >
        <foreach collection="listExpStocks" item="item"  index="index"  separator=";">
            UPDATE expStocks 
            <set>
                tratado = #{ item.tratado , jdbcType = VARCHAR }
                , fechaTratado = #{ item.fechaTratado , jdbcType = TIMESTAMP }
            </set>
            WHERE id = #{ item.id , jdbcType = INTEGER }
        </foreach>
    </update>
    
    <select id="inventarioUlises" resultType="com.seidor.ulises.model.ExpStocks" parameterType="com.seidor.ulises.model.ExpStocks">
        select art.ARTICULO , SUM(ubic.CANTIDAD) as cantidad , lot.LOTE  
        from ARTICULO art
        inner join LOTE lot on (art.ARTICULO = lot.ARTICULO)
        inner join UBICSTOCK ubic on (lot.IDLOTE = ubic.LOTE)
        group by art.ARTICULO , lot.LOTE
    </select>
</mapper>